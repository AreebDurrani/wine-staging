From 78788eadc3924bf11db3cd3185c448b1559d9b37 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Sat, 23 May 2020 18:17:52 +1000
Subject: [PATCH] ntoskrnl.exe: Add KdRefreshDebuggerNotPresent stub

Wine-Bug: https://bugs.winehq.org/show_bug.cgi?id=49216
Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 dlls/ntoskrnl.exe/ntoskrnl.c        | 9 +++++++++
 dlls/ntoskrnl.exe/ntoskrnl.exe.spec | 1 +
 include/ddk/wdm.h                   | 1 +
 3 files changed, 11 insertions(+)

diff --git a/dlls/ntoskrnl.exe/ntoskrnl.c b/dlls/ntoskrnl.exe/ntoskrnl.c
index 77d6ccd38ab5..80f18b64d15d 100644
--- a/dlls/ntoskrnl.exe/ntoskrnl.c
+++ b/dlls/ntoskrnl.exe/ntoskrnl.c
@@ -3846,6 +3846,15 @@ NTSTATUS WINAPI SeLocateProcessImageName(PEPROCESS process, UNICODE_STRING **ima
     return STATUS_NOT_IMPLEMENTED;
 }
 
+/*********************************************************************
+ *           KdRefreshDebuggerNotPresent    (NTOSKRNL.@)
+ */
+BOOLEAN WINAPI KdRefreshDebuggerNotPresent(void)
+{
+    FIXME("stub\n");
+    return FALSE;
+}
+
 /*********************************************************************
  *           KeFlushQueuedDpcs    (NTOSKRNL.@)
  */
diff --git a/dlls/ntoskrnl.exe/ntoskrnl.exe.spec b/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
index 651fe4852b93..cae3ff34426b 100644
--- a/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
+++ b/dlls/ntoskrnl.exe/ntoskrnl.exe.spec
@@ -48,6 +48,7 @@
 @ stub IoWritePartitionTable
 @ stdcall -fastcall IofCallDriver(ptr ptr)
 @ stdcall -fastcall IofCompleteRequest(ptr long)
+@ stdcall KdRefreshDebuggerNotPresent()
 @ stdcall -arch=!i386 KeAcquireInStackQueuedSpinLock(ptr ptr)
 @ stdcall -fastcall KeAcquireInStackQueuedSpinLockAtDpcLevel(ptr ptr)
 @ stdcall KeEnterGuardedRegion()
diff --git a/include/ddk/wdm.h b/include/ddk/wdm.h
index 707eca0b32f5..4f4fbcbef4e9 100644
--- a/include/ddk/wdm.h
+++ b/include/ddk/wdm.h
@@ -1675,6 +1675,7 @@ void      WINAPI IoReleaseRemoveLockEx(IO_REMOVE_LOCK*,void*,ULONG);
 NTSTATUS  WINAPI IoSetDeviceInterfaceState(UNICODE_STRING*,BOOLEAN);
 NTSTATUS  WINAPI IoWMIRegistrationControl(PDEVICE_OBJECT,ULONG);
 
+BOOLEAN   WINAPI KdRefreshDebuggerNotPresent(void);
 void    FASTCALL KeAcquireInStackQueuedSpinLockAtDpcLevel(KSPIN_LOCK*,KLOCK_QUEUE_HANDLE*);
 #ifdef __i386__
 void      WINAPI KeAcquireSpinLock(KSPIN_LOCK*,KIRQL*);
-- 
2.26.2

